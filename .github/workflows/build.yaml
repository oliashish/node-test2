
name: Github action for your deployment
on:
    push:
      branches: main

jobs:
    build:

        runs-on: ubuntu-latest
        strategy:
            matrix: 
                node-version: [16.14.2]
        steps:
        - uses: actions/checkout@v3
        - name: Using node 16.14.2
          uses: actions/setup-node@v2
          with: 
            node-version: 16.14.2
        - run: npm install
        - name: Creating a Dockerfile
          run: |
            echo "
            FROM node:16.14.2
            WORKDIR /app
            COPY . .
            RUN npm install
            CMD ["node", "server"]
            " > Dockerfile

        - name: Build image from Dockerfile and push to patr-registry
          uses: docker/login-action@v1 
          with:
            registry: registry.patr.cloud
            username: ashish-oli
            password: ${{ secrets.REGISTRY_PASSWORD }}
        - run: |
            docker build . -t ashish-oli/deployment
            docker tag ashish-oli/deployment registry.patr.cloud/personal-workspace-1424404d9fff474bba7f23825681f6a8/testing:latest 
            docker push registry.patr.cloud/personal-workspace-1424404d9fff474bba7f23825681f6a8/testing:latest 
